@using LanWatcher.Models

<div class="stats-dashboard">
    <div class="stat-card clickable @(ActiveFilter == "all" ? "active" : "")" @onclick='() => SetFilter("all")'>
        <div class="stat-icon">ğŸ“¡</div>
        <div class="stat-content">
            <span class="stat-number">@TotalDevices</span>
            <span class="stat-label">Devices Found</span>
        </div>
    </div>

    <div class="stat-card clickable @(ActiveFilter == "online" ? "active" : "")" @onclick='() => SetFilter("online")'>
        <div class="stat-icon">ğŸŸ¢</div>
        <div class="stat-content">
            <span class="stat-number">@OnlineDevices</span>
            <span class="stat-label">Online Now</span>
        </div>
    </div>

    <div class="stat-card warning clickable @(ActiveFilter == "risks" ? "active" : "")" @onclick='() => SetFilter("risks")'>
        <div class="stat-icon">âš ï¸</div>
        <div class="stat-content">
            <span class="stat-number">@PotentialRisks</span>
            <span class="stat-label">Potential Risks</span>
        </div>
    </div>

    <div class="stat-card clickable @(ActiveFilter == "webservers" ? "active" : "")" @onclick='() => SetFilter("webservers")'>
        <div class="stat-icon">ğŸ–¥ï¸</div>
        <div class="stat-content">
            <span class="stat-number">@WebServers</span>
            <span class="stat-label">Web Servers</span>
        </div>
    </div>

    <div class="stat-card clickable @(ActiveFilter == "printers" ? "active" : "")" @onclick='() => SetFilter("printers")'>
        <div class="stat-icon">ğŸ–¨ï¸</div>
        <div class="stat-content">
            <span class="stat-number">@Printers</span>
            <span class="stat-label">Printers</span>
        </div>
    </div>

    <div class="stat-card clickable @(ActiveFilter == "cameras" ? "active" : "")" @onclick='() => SetFilter("cameras")'>
        <div class="stat-icon">ğŸ“·</div>
        <div class="stat-content">
            <span class="stat-number">@Cameras</span>
            <span class="stat-label">Cameras</span>
        </div>
    </div>

    <div class="stat-card clickable @(ActiveFilter == "smart" ? "active" : "")" @onclick='() => SetFilter("smart")'>
        <div class="stat-icon">ğŸ </div>
        <div class="stat-content">
            <span class="stat-number">@SmartDevices</span>
            <span class="stat-label">Smart Devices</span>
        </div>
    </div>

    <div class="stat-card clickable @(ActiveFilter == "unknown" ? "active" : "")" @onclick='() => SetFilter("unknown")'>
        <div class="stat-icon">â“</div>
        <div class="stat-content">
            <span class="stat-number">@UnknownDevices</span>
            <span class="stat-label">Unknown</span>
        </div>
    </div>
</div>

@if (!string.IsNullOrEmpty(ActiveFilter) && ActiveFilter != "all")
{
    <div class="filter-indicator">
        <span>Filtering: <strong>@GetFilterLabel()</strong> (@FilteredCount devices)</span>
        <button class="clear-filter-btn" @onclick='() => SetFilter("all")'>âœ• Clear</button>
    </div>
}

@code {
    [Parameter] public List<NetworkDevice> Devices { get; set; } = new();
    [Parameter] public string ActiveFilter { get; set; } = "all";
    [Parameter] public EventCallback<string> OnFilterChanged { get; set; }

    private int TotalDevices => Devices.Count;
    private int OnlineDevices => Devices.Count(d => d.IsOnline);
    private int TotalOpenPorts => Devices.Sum(d => d.OpenPorts.Count);
    private int WebServers => Devices.Count(d => d.DeviceType == DeviceType.WebServer);
    private int Printers => Devices.Count(d => d.DeviceType == DeviceType.Printer);
    private int Cameras => Devices.Count(d => d.DeviceType == DeviceType.Camera);
    private int SmartDevices => Devices.Count(d => d.DeviceType == DeviceType.SmartHome || d.DeviceType == DeviceType.SmartTV);
    private int UnknownDevices => Devices.Count(d => d.DeviceType == DeviceType.Unknown);

    // Potential risks: devices with high/critical risk level
    private int PotentialRisks => Devices.Count(d => 
        d.RiskLevel == RiskLevel.High || d.RiskLevel == RiskLevel.Critical);

    private int FilteredCount => ActiveFilter switch
    {
        "online" => OnlineDevices,
        "risks" => PotentialRisks,
        "webservers" => WebServers,
        "printers" => Printers,
        "cameras" => Cameras,
        "smart" => SmartDevices,
        "unknown" => UnknownDevices,
        _ => TotalDevices
    };

    private string GetFilterLabel() => ActiveFilter switch
    {
        "online" => "Online Devices",
        "risks" => "Potential Risks",
        "webservers" => "Web Servers",
        "printers" => "Printers",
        "cameras" => "Cameras",
        "smart" => "Smart Devices",
        "unknown" => "Unknown Devices",
        _ => "All Devices"
    };

    private async Task SetFilter(string filter)
    {
        await OnFilterChanged.InvokeAsync(filter);
    }
}
